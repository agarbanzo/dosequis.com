'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _gplaces = require('utils/gplaces');

var _gplaces2 = _interopRequireDefault(_gplaces);

var _GmapDragSearch = require('./GmapDragSearch.js');

var _GmapDragSearch2 = _interopRequireDefault(_GmapDragSearch);

var _dragMapList = require('./dragMapList');

var _dragMapList2 = _interopRequireDefault(_dragMapList);

var _tracking = require('services/google-analytics/tracking');

var _tracking2 = _interopRequireDefault(_tracking);

var _loader = require('components/loader/loader');

var _loader2 = _interopRequireDefault(_loader);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

require('jquery.transit');
require('components/touts/touts');
require('scss/pages/beerlocator.scss');

var Beerlocator = function () {
	function Beerlocator(selector) {
		var _this2 = this;

		_classCallCheck(this, Beerlocator);

		var _this = this;
		this.data = {};
		this.category = 'stores';
		this.currentFilter = '';
		this.filter = 'all';
		this.maplist = new _dragMapList2.default('#results');
		this.map = new _GmapDragSearch2.default({ lat: 40.73186, lng: -73.98863 });
		this.input = document.getElementById("ZipCode");
		this.input.value = '10003';
		_gplaces2.default.autoComplete(this.input);
		_gplaces2.default.getFirstSuggestion(this.input);

		$(document).ready(function () {
			_this2.addUIListeners();
			$('.mapview,.fb-list').addClass('hide');
		});

		$('#ZipCode').on('blur', function (e) {
			var v = this.value;
			if (this.value.length == 0) this.value = v;
			_this.scrollWindow();
		}).on('focus', function () {
			console.log('focus');
			this.value = "";
		});

		window.dispatcher.on('onShowMap', function () {
			return _this2.showMap();
		});
		window.dispatcher.on('onFirstSuggestion', function () {
			return _this2.scrollWindow();
		});
		window.dispatcher.on('onSetFilterSelected', function (e) {
			return _this2.setFilterSelected(e[0]);
		});
		window.dispatcher.on('onNoLocationsFound', function (e) {
			return _this2.showMap();
		});
	}

	_createClass(Beerlocator, [{
		key: 'filterProducts',
		value: function filterProducts(id) {
			this.filter = id;
			window.dispatcher.trigger('onFilterChange');
			this.setFilterSelected(this.filter);
			this.scrollWindow();
		}
	}, {
		key: 'setFilterSelected',
		value: function setFilterSelected(id) {
			if (id !== undefined) {
				$('input.filter[data-filter=' + id + ']').attr('checked', true);
				$('input.filter[data-filter!=' + id + ']').attr('checked', false);
			}
		}
	}, {
		key: 'scrollWindow',
		value: function scrollWindow() {
			if (window.screen.width < 769) $('html, body').animate({ scrollTop: 600 }, 800);
		}
	}, {
		key: 'addUIListeners',
		value: function addUIListeners() {
			var _this3 = this;

			var _this = this;
			$('.viewlist').on("click", function (e) {
				return _this3.hideMap();
			});
			$('.mapview').on("click", function (e) {
				return _this3.showMap();
			});
			$(".bars, .stores").on("click", function (e) {
				_this3.scrollWindow();window.dispatcher.trigger('onTypeChange');
			});
			$('.filter').on('click', function (e) {
				return _this3.filterProducts($(e.target).data('filter'));
			});
			//===================================LOCATE ME
			$('.locateme').on('click', function (e) {
				e.preventDefault();
				window.dispatcher.trigger('onShowLoader');
				if (navigator.geolocation) {
					var geo_success = function geo_success(position) {
						var pos = {
							lat: position.coords.latitude,
							lng: position.coords.longitude
						};
						_this.map.address = 'street_address';
						window.dispatcher.trigger('onInitMap', [pos]);
						_this.scrollWindow();
						_this.maplist.reset();
						_gplaces2.default.getAddress(pos).then(function (zipcode) {
							_this.input.value = zipcode;
						});
					};

					var geo_error = function geo_error(err) {
						window.dispatcher.trigger('onHideLoader');
						_this.scrollWindow();
						_this.map.showErrorMsg('Geolocation is not available');
					};

					navigator.geolocation.getCurrentPosition(geo_success, geo_error);
				}
			});
		}
	}, {
		key: 'hideMap',
		value: function hideMap() {
			if (!this.maplist.listItems.length) return;
			$('.fb-list').removeClass('hide');
			$('.mapview').removeClass('hide');
			$('.viewlist').addClass('hide');
			$('.fb-map').css('visibility', 'hidden');
			this.map.info_window.close();
			this.maplist.setListView(true);
		}
	}, {
		key: 'showMap',
		value: function showMap() {
			$('.viewlist,.mapview').removeClass('hide');
			$('.mapview,.fb-list').addClass('hide');
			$('.fb-map').css('visibility', 'visible');
			this.maplist.setListView(false);
		}
	}]);

	return Beerlocator;
}();

exports.default = Beerlocator;

var barfinder = new Beerlocator('.beerlocator');